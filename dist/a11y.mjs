import{writeFileSync as r}from"fs";import n from"minimist";import{bold as e,white as t,magenta as o}from"colors";import{AxePuppeteer as i}from"axe-puppeteer";import{launch as s}from"puppeteer";import u from"pa11y";import c from"ora";import{resolve as l}from"path";var a=function(r){return t(r)},f=function(r){return e(r).red},p=function(r){return e(r).green},m=function(r){return o(r)},h=function(){for(var r=[],n=arguments.length;n--;)r[n]=arguments[n];return console.log.apply(console,r.map(a))},v=function(){for(var r=[],n=arguments.length;n--;)r[n]=arguments[n];return console.log.apply(console,r.map(f))},y=function(r){try{return Promise.resolve(g(r)).then(function(r){var n=r.results;return{documentTitle:r.documentTitle,pageUrl:n.url,errors:n.violations,warnings:n.incomplete,notices:n.inapplicable}})}catch(r){return Promise.reject(r)}},g=function(r){try{return Promise.resolve(s()).then(function(n){return Promise.resolve(n.newPage()).then(function(e){return Promise.resolve(e.setBypassCSP(!0)).then(function(){return Promise.resolve(e.goto(r)).then(function(){return Promise.resolve(new i(e).analyze()).then(function(r){return Promise.resolve(e.title()).then(function(t){return Promise.resolve(e.close()).then(function(){return Promise.resolve(n.close()).then(function(){return{results:r,documentTitle:t}})})})})})})})})}catch(r){return Promise.reject(r)}},d=function(r){try{return Promise.resolve(u(r,{rootElement:"#__next",standard:"WCAG2A",includeNotices:!0,includeWarnings:!0})).then(function(r){return{documentTitle:r.documentTitle,pageUrl:r.pageUrl,errors:r.issues.filter(function(r){return"error"===r.type}),warnings:r.issues.filter(function(r){return"warning"===r.type}),notices:r.issues.filter(function(r){return"notice"===r.type})}})}catch(r){return Promise.reject(r)}},P=["axecore","pa11y"];!function(){var t=n(process.argv.slice(2)),o=t.url,i=function(r,n){var e={};for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&-1===n.indexOf(t)&&(e[t]=r[t]);return e}(t,["url"]);if("string"!=typeof o||""===o)return v("a11y can't find a url");var s={out:l(process.cwd())};!function(n,t){try{var o=t.out,i=(a="Gathering a11y insights for "+m(n),c(a));h("\n"),i.start();var s=Promise.all([y(n),d(n)]),u=function(n,t){try{var i=function(n,t){try{var i=Promise.resolve(s).then(function(n){var t="\n      "+"Accessibility Results For:".toUpperCase()+"\n      -----------\n      "+n[0].documentTitle+"\n      "+n[0].pageUrl+"\n    ";n.forEach(function(n,i){t+="\n      "+function(r,n,t){var o=l(n,"a11y-report-"+P[i]+".json");return"\n    -----------\n    "+f("A11y:: Errors found: "+r.errors.length)+"\n    "+e("A11y:: Warnings Found: "+r.warnings.length).yellow+"\n    "+e("A11y:: Notices Found: "+r.notices.length).cyan+"\n    -----------\n    Reports saved in "+m("<"+o+">")+"\n  "}(n,o)+"\n      ",r(l(o,"a11y-report-"+P[i]+".json"),JSON.stringify(n,function(r,n){return void 0===n?"undefined":n},2))}),h(t),process.exitCode=0})}catch(r){return t(r)}return i&&i.then?i.then(void 0,t):i}(0,function(r){v(r),process.exitCode=1})}catch(r){return t(!0,r)}return i&&i.then?i.then(t.bind(null,!1),t.bind(null,!0)):t(!1,value)}(0,function(r,n){if(function(){for(var r=[],n=arguments.length;n--;)r[n]=arguments[n];console.log.apply(console,r.map(p))}("Done!"),i.stop(),r)throw n;return n});Promise.resolve(u&&u.then?u.then(function(){}):void 0)}catch(r){return Promise.reject(r)}var a}(o,Object.assign({},s,i))}();
//# sourceMappingURL=a11y.mjs.map
